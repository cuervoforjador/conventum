export class pixiSheet{_canvasID="backSheet";_assetsPath="/systems/"+game.system.id+"/assets/";_layerOptions={interactive:!0,fullView:!0,opacity:1,backgroundColor:14540253,antialias:!0};_center={x:0,y:0};_area=null;_canvas=null;_background=null;_cameraControl=null;_loader={mesh:{},lighting:{}};_sheet=null;_context=null;_systemData=null;constructor(t,i){this._sheet=t,this._context=i,this._systemData=i.systemData,this._initCanvas()}getSheetID(){return $(this._sheet).attr("id")}getWindowApp(){return $(this._sheet.form).parents(".window-app")}getFrameSize(){return{width:this._sheet.options.width+.2*this._sheet.options.width,height:this._sheet.options.height+.2*this._sheet.options.height,rX:.1*this._sheet.options.width,rY:.1*this._sheet.options.width}}async drawCanvas(){this.drawSmoke()}_initCanvas(){try{this._buildCanvas(),this._initApp(),this._initListeners()}catch(t){ui.notifications.error(t)}}_buildCanvas(){let t=$(this._sheet.form).parent();$(this._sheet.form),t.find("#"+this._canvasID).remove(),this._canvas=$(`<div id="${this._canvasID}" style="position: absolute"></div>`),this._layerOptions.interactive||this._canvas.css({pointerEvents:"none"}),this._canvas.prependTo(t),this._canvas.width(this.getFrameSize().width),this._canvas.height(this.getFrameSize().height),this._canvas.css({left:"-"+this.getFrameSize().rX.toString()+"px",top:"-"+this.getFrameSize().rY.toString()+"px"})}_initApp(){this.app&&this.app.destroy(),this.app=new PIXI.Application({backgroundAlpha:0,antialias:!0,width:this.getFrameSize().width,height:this.getFrameSize().height}),this._canvas[0].appendChild(this.app.view),this._center.x=Math.round(this.app.view.width/2),this._center.y=Math.round(this.app.view.height/2),this.app._assetsPath=this._assetsPath,this.app._config=this._config,this.app._center=this._center,this.app._tickers={},this._background=new PIXI.Container,this.app.stage.addChild(this._background)}_initListeners(){this.getWindowApp().resize(()=>{this._rtime=new Date,!1===this._timeout&&(this._timeout=!0,setTimeout(this._resizeEnd.bind(this),1e3))})}_resizeEnd(){new Date-this._rtime<1e3?setTimeout(this._resizeEnd.bind(this),1e3):(this._timeout=!1,this._rebuild())}_rebuild(){this._removeCanvas(),this._buildCanvas()}_removeCanvas(){this.app.view.remove(),this.app.destroy(),this._canvas[0].remove()}async drawSmoke(){let t=Math.trunc(this._canvas.height()/650*120);t>200&&(t=200),t<100&&(t=100);let i=new PIXI.Container;this._background.addChild(i);let e=PIXI.Texture.from(this._assetsPath+"pixiSheet/smoke.png",{resourceOptions:{autoLoad:!1}});await e.baseTexture.resource.load();let s=.5*e.width,a=.5*e.height,h=this._canvas.width()-e.width,n=this._canvas.height()-e.height,r=[];for(let o=0;o<t;o++){let d=new PIXI.Sprite(e);d.position.set(s+Math.random()*h,a+Math.random()*n),d.anchor.set(.5),d.rotation=360*Math.random(),d.alpha=.5,d.blendMode=PIXI.BLEND_MODES.SCREEN,d.tint="0xFFFFFF",d._speed=(p(0,100)-50)/1e4,i.addChild(d),r.push(d)}function p(t,i){return Math.floor(Math.random()*(i-t)+1)+t}this.app._tickers.smokeBackground=new PIXI.Ticker,this.app._tickers.smokeBackground.speed=.5,this.app._tickers.smokeBackground.add(t=>{(function t(i){let e=r.length;for(;e--;){let s=r[e]._speed;r[e].rotation+=i*s}})(t)}),this.app._tickers.smokeBackground.start()}}