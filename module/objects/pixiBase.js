import{pixiHelper as t}from"./pixiHelper.js";export class pixiBase{_canvasID="pixiRollCANVAS";_assetsPath="/systems/"+game.system.id+"/assets/";_stylesPath="/systems/"+game.system.id+"/styles/";_layerOptions={interactive:!0,opacity:.82,fullView:!0};_center={x:0,y:0};_area={left:0,top:0,width:0,height:0};_canvas=null;_background=null;_rtime=null;app=null;constructor(t){try{t.layerOptions&&(this._layerOptions={...this._layerOptions,...t.layerOptions}),this._initScreenArea(),this._buildCanvas(),this._initCanvas(),this._initListeners()}catch(i){ui.notifications.error(i)}}async draw(){await this._initFonts(),this._drawCloseButton()}_initScreenArea(){let t=$("#sidebar").width(),i=t>window.innerWidth/2?0:t;this._area={...this._area,left:0,top:0,width:this._layerOptions.fullView?window.innerWidth:window.innerWidth-i,height:window.innerHeight-1}}_buildCanvas(t,i){this._area&&($("#"+this._canvasID).remove(),this._canvas=$(`<div id="${this._canvasID}" 
                              style="position: absolute; 
                                     left: ${this._area.left}px; 
                                     top: ${this._area.top}px; 
                                     ${this._layerOptions.interactive?"":"pointer-events: none;"}">
                         </div>`),this._canvas.css("z-index",1e3),this._canvas.appendTo($("body")),this._canvas.width(this._area.width+"px"),this._canvas.height(this._area.height+"px"))}_initCanvas(){this.app&&this.app.destroy(),this.app=new PIXI.Application({backgroundAlpha:this._layerOptions.opacity,resizeTo:this._canvas[0]}),this._canvas[0].appendChild(this.app.view),this._center.x=Math.round(this.app.view.width/2),this._center.y=Math.round(this.app.view.height/2),this.app._assetsPath=this._assetsPath,this.app._config=this._config,this.app._center=this._center,this.app._tickers={},this._background=new PIXI.Container,this.app.stage.addChild(this._background)}_initListeners(){$(window).resize(()=>{this._rtime=new Date,!1===this._timeout&&(this._timeout=!0,setTimeout(this._resizeEnd.bind(this),1e3))})}async _initFonts(){await PIXI.Assets.load(this._stylesPath+"/almendra.ttf"),await PIXI.Assets.load(this._stylesPath+"/almendrabold.ttf")}_resizeEnd(){new Date-this._rtime<1e3?setTimeout(this._resizeEnd.bind(this),1e3):(this._timeout=!1,this._rebuild())}_rebuild(){this._removeCanvas(),this._buildCanvas()}_removeCanvas(){this.app.view.remove(),this.app.destroy(),this._canvas[0].remove()}async _drawCloseButton(){let i=new PIXI.Container,s=await t.spriteTex("seal.png",70,70);i.addChild(s);let e=await t.spriteTex("x.png",38,38,16,16);e.filters=[new PIXI.AlphaFilter(.4)],i.addChild(e),this.app.stage.addChild(i),i.x=this.app.view.width-75,i.y=10,t.spriteClick(i,t=>{t.preventDefault(),this._removeCanvas()}),i.on("mouseover",t=>{t.preventDefault(),e.filters=[new PIXI.AlphaFilter(1)]}),i.on("mouseout",t=>{t.preventDefault(),e.filters=[new PIXI.AlphaFilter(.4)]})}}